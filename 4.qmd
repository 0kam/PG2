# RStudioを用いた地理情報解析の基礎

ここでは、二回にわたってRを用いた地理情報解析を実践してゆきます。 まずは、解析用のフォルダを前回作成した`PG2/`以下に`PG2/4/`として作成しましょう。

## テーマ1. DEMデータで遊ぶ

今回のテーマは、前回軽く扱った国土地理院の数値標高モデル（DEM）データを用いて実践的な解析を行うことです。

### データの準備

もう少し広い範囲のDEMデータを準備して、Rを駆使しながら遊んでみましょう。 まずは、前回と同様に[基盤地図情報ダウンロードサービス](https://service.gsi.go.jp/kiban/app/)からDEMデータをダウンロードします。墨田区から武蔵野市にかけて、東西方向に3つのタイルを選択します。

![](images/4/1_1.png)

「ダウンロードリストに全て追加」→「ダウンロード等へ」→「まとめてダウンロード」を選択し、メールで送られてきたリンクからダウンロードします。 今回は、`2025xxxxxxxxxxxx-001.zip`のようなZIPファイルがダウンロードされているので、これを`PG2/4/`に移動し、解凍します。

```         
4
└── 20250830131401458-001
    ├── FG-GML-533944-DEM5A-20250620.zip
    ├── FG-GML-533945-DEM5A-20250620.zip
    ├── FG-GML-533946-DEM5A-20250620.zip
    ├── fmdid15-3101.xml
    └── fmdid25-3101.xml
```

このような形で、`.zip`ファイルが3つあるはずです。 それでは、これをそれぞれQGISでGeoTIFFファイルに変換しましょう。 今回は、`GeoTIFFの出力先`を`[一時ファイル保存]`にします。 ![](images/4/1_2.png)

以下のような感じで、3つのDEMファイルが読み込まれました。

![](images/4/1_3.png)

次に、これらを一つに結合します。`ラスタ→その他→結合`を選び、`入力レイヤ`に先ほど作成された3つのレイヤ（`GeoTIFFの出力先`という名前のはず）を選択し、`実行`を押します。

![](images/4/1_4.png)

結合されたレイヤが作成されるので、これをGeoTIFFファイルとして保存します。
`出力レイヤ`を右クリックし、`エクスポート→名前をつけて保存`を選びます。`ファイル名`を編集して、`PG2/4/`に`dem_tokyo`という名前で保存しましょう。

![](images/4/1_5.png)

ファイルエクスプローラを使って、`PG2/4/dem_tokyo.tif`が存在することを確かめます。

### まずはRで読み込んでみる
それでは、RStudioに画面を切り替えます。 RStudioの左上にある新規作成ボタン（白紙に緑のプラスマーク）を押し、`R Script`を選択します。


```{R}

```

### ベクターデータと組み合わせてみる

#### 市区ごとの標高をグラフにする

#### 地形の断面を見てみる

#### 河川の勾配をグラフにする

## テーマ2. 

## 余談：プログラミングに入門するときのコツ

いきなり意味のわからないプログラムが出てきてやる気なくしますよね（普通そうだと思います）。しかし、ちょっとした解析やデータの整理、グラフ作成を行う能力はきっと将来役に立つはずです。Rはそのためのツールとしてとても優れています。とはいえ、「コピペだけしても何もわかった気にならない」みたいな気持ちを持ったまま授業に臨むのは辛いので、ここでは僕がプログラミングに入門する際に重要だと思っていることを書きます。

1.  雑にやる プログラムの意味が分かってなくても、動けばいいです。 「なんか絵が出た！」という素朴な楽しさを大切にしましょう。

2.  エラーメッセージは「怒られ」ではない エラーが出たらちょっとびっくりしますよね。エラーが出ると怒られた気持ちになってプログラミングを挫折したという話も聞いたことがあります。しかし、エラーが出ないように気をつけてプログラムを書くのは、（R初学者にとっては）あまり良いとは思いません。エラーをたくさん読むことが、プログラムのルールを学ぶ近道だと思います。自信がなくてもとりあえず実行してみて、結果を見ながら改善する、というループをできるだけたくさん回しましょう。
